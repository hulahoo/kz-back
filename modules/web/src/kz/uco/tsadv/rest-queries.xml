<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<queries xmlns="http://schemas.haulmont.com/cuba/rest-queries.xsd">
    <query name="usersActivities" entity="uactivity$Activity" view="_local">
        <jpql>
            select e
            from uactivity$Activity e
            where e.assignedUser.id = :currentUserId
            and e.status = :activeStatusId
            and e.type.code = :notificationCode
            order by e.createTs desc
        </jpql>
        <params>
            <param name="currentUserId" type="java.util.UUID"/>
            <param name="activeStatusId" type="java.lang.Integer"/>
            <param name="notificationCode" type="java.lang.String"/>
        </params>
    </query>
    <query name="myProfile" entity="base$PersonExt" view="_local">
        <jpql>
            select p
            from base$PersonExt p
            where p.group.id = :userId
        </jpql>
        <params>
            <param name="userId" type="java.util.UUID"/>
        </params>
    </query>
    <query name="personGroupInfo" entity="base$PersonGroupExt" view="_local">
        <jpql>
            select p
            from tsadv$UserExt u
            inner join u.personGroup p
            where u.id = :userId
        </jpql>
        <params>
            <param name="userId" type="java.util.UUID"/>
        </params>
    </query>
    <query name="kpiEditPage" entity="tsadv$AssignedPerformancePlan" view="assignedPerformancePlan-myKpi-edit">
        <jpql>
            <![CDATA[select app
            from tsadv$AssignedPerformancePlan app
                left join app.assignedPerson ap
                left join ap.assignments a
            where app.id = :appId
                and a.startDate <= CURRENT_DATE
                and a.endDate >= CURRENT_DATE
                and a.primaryFlag = true
            ]]>
        </jpql>
        <params>
            <param name="appId" type="java.util.UUID"/>
        </params>
    </query>
</queries>
